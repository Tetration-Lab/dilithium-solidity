// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.25;

import "forge-std/Test.sol";
import "forge-std/console2.sol";
import "../src/Constants.sol";
import "../src/Dilithium.sol";
import "../src/Packing.sol";

contract DilithiumGasTracker {
    function verify(Dilithium.Signature memory sig, Dilithium.PublicKey memory pk, bytes memory m)
        public
        pure
        returns (bool)
    {
        return Dilithium.verify(sig, pk, m);
    }
}

contract DilithiumTest is Test {
    DilithiumGasTracker tracker;

    function setUp() public {
        tracker = new DilithiumGasTracker();
    }

    function test_hash() public pure {
        bytes memory m = hex"6861736868617368"; // hashhash
        bytes32 hashed = keccak256(m);
        assertEq(hashed, hex"d89a6e660e847e3cee8476e0f6b65d1832e87b89f58d3c15edd5ea2a086e3861");
    }

    function test_verify() public view {
        Dilithium.PublicKey memory pk = Packing.unpack_pk(
            hex"d6f4bf66871d67487911795dcb9afc8d45ed9df7029a25f86d995d5e8bb2c5c793c1762cdf0a439ff0efaaa6edc9a438559b6a4e07070688aa6bc01c9e70cdd86eb02411b102ca1c7ca33b008c62d968f440f8268f9fb0a17a676d70a6650cc4e6b8f853b79ae6d02356fcc1ba0bf1eed3a392ec423c9242792fbbb0ae1ef7f9d0f266e7e12194d27443d552091931985a9c5714a641851b4f224e120a40190ed6c5351b7e268f24629ce86c31f4b06592d128b8cafd102b56efc4150a56babf5a4d8a16215f42351c7c9c2cc64876d8af4a1a262e323e8e700a80686fa80fef0267934825383faf3467ef6f11833d23f84cea4ef9896a62a54aaea1ef5c5c6ab0606570b22219d6107aa9eb2c8b415ea394189aa712b29717cbea8d6dd2c4b16c8f9735be3fc3d482b84dc42cd646f7e495f9bdd400bf4f0bb66ac7c6f1fc64b7f4f3aa2cf58a8a9c9dfb8b4d2e9f367c78929800ccfc51a09bd142b24cd14d8d84557d6a371de1aca38a955dfdbd71e439ecf8d533f6349afca71a750ea0e87f75e633a593826dfdb6f78a1f3a515197de6e909005c0018b4f70af2825094ba068842fdb469d47bad568631921dcecb58ba410c9b394d3ab932019981a1f56fe65d3a2e90369a9e4bc9c1c5fd17527a9159fe280ff37f208d05cef45167d80a5501dfa8df0925c01b1a291f776270cbaa4e7bcd34343a949dcbed67f5238d04eedba803530ed7c8a7144cead73fa596e89f331f65dcd4086a41559b5406a681f6dd3f7ef183e694113d73878cd65a2244630cf8086b5aba2d77d670409cff4baf8d2c4c3fee585a42ee749c81eb13b218046c46f502c6201946a22bb08ec6ee61be70aab60c24779d75c38a70c574c85d0df2964167ed4518de30f9d21f60949a08f62510e4a4c2398d77959bb24ec999f47b96a636f75f826cc7d4af294a9c1c0b23cbb93e05d779480a68662bc05e4a3cbaefc8f28348f1e87674279cc3a37c490c42b43da080d99b3a1813343c67a798a28bf5a35e30301777020c50fdae284d6463e4b423fe0b05e53670d7a1435e0d7e99f172e63701e4a365e51e5bcf7bbf87145819bb2f1c25f5b06df2a2af9e1e5cacf42f907405a6569cadcc4837f1c84fd1c3d9a26690023ecd742b2b9c084a5e50e0f5fe2663c50a251fadbb0e6adf05f0abd9a864507af97e3265dd6a504e83300d2c8e57077ae20fcc2ec517b54b955b7a7910d7aae4fa89d0fe3e03136f0ead4c060eb7bc22150d76fddf11a38df02e94f194985244f410fec9fbaeb94c828ad87a71e32b9916c6d87591bff7cd86738e94449c62af35ebf777ef403a5bdd510597b9a7fcd0f92c1896dd859d2e683d717fe499562ea7787fcddea128d6d83cad40c3106cd52edc8d3caf67229930776070b97e92f61fabf0bcc115c3728a4ead1370ba9afc722369ad950bfe1c2a44ce6c359b99108333ca8850754de23435f447f10ec255f9f9924451c9a26796d3796209cae55513b863ab20ffccb23c89936bf9068a4df476d6c9e806d7f601fca8182760e9df5c5b4f9f4cc8ee84241eb53e67063c8cb27a9f5d0832140b4d1f211cb45dc469f07d9c5e58246baebd6436ced7f3cc8277944c06ab8f72f418a9bc0c7c927338482fbf44cb226d56adf204ca2035a1be7a1ebf15a73f88240179e5679a2bb787465ba16df2eea0c71c6b37988e83af5a74de3a3f3d94a7a2735b4ee409b9174eb31d8b1a95f26fb3e7282ccddff69ed23675c7fdf4412e10b970f8a88855c41830cb8475cb80f7142fd5bcdcc0354040b1e228ab48f3327529f46458788f66427f5a20bca223da2854a54a3729d09c00f415af255bf"
        );
        Dilithium.Signature memory sig = Packing.unpack_sig(
            hex"1893efe686a121b36cbb902e0b1c4964564ff5b478e0ad8422d97c1e748982505870a464c83e2dd70d9de644a8f18697927de25cddc0bb3993ca022990fea66bbd2ed6c8027ddfeeca50bdf844f7ffb8b1f132db874a90bd58c30bd1cf9698db5514dcd978e16ce4fac8a790043886a4cb38597d80a294c13430f6958f1dc3568b4ef6cd3bc58bbf5190df0bab89484de6b2bc43a377a8721255e4f27e0fb62158ec3ba67058854dbcec653197c8ddb82589a074bf5655b3d4b366fd465a341d616899b21cea3f53b7b18dc23be454c666b626ef74db081eaf26935ae2abd7806c7e5beb624b97926f61b028e89d55180cd9d7a00ecbdd9189e2b7e8781043d9ebec7e702788395a30a6aa068e09d18e8481499cface625e88e15c35926ba2e9b2636724455647c4c48917b06cd049fb81d956a0032618738bcb8b61dd95a984e512f24ebccace1fbfed3eaaeafe2ff2b6dcfcfefb2af46f9d78d63e393387a1de770e882ba10db086f82d753fc793c2f73ad27b7c33adea66e623e1cc4cabb62c33f9ad7df8e805613b8f48f0a5a08508719215a0bae9d20a04a9da340183cc4fdeb152968d0bce6e7513ae5edadc681612134c8c8d02684eb6381f622abada938326c29dc60fb17b094c77a0eecb6944b0702b9191daec3414e2ae51fff04a9ec14584e34caaae243665f543f0360d47c5eaffab6a958992ce2370697cfc19f50e2fa96e41bac6c04345ae3eda77bf9079b2c13613c7e5e62bbe996559ff4dda00ce243702e9c9c50b5f1de431ab6f13ac379659a987b3268d0a73eee3cb37d4d96dfa90a6497c7c54a1904199bb12d48cffc7efe4396d57f5c3825f3c07d0209f25a0444302a4bc8e6fb4bcac5e70eaeac1b16ad4e7ec8ed1f88d292d9221fe9ee0aef409124af1f202e2ec0dbcfda9033a610e9907d9692976a5b3c41d3bee4966f043278a77f722fa092eded3d5d37a573f83ced5527d54dfabc0f8b4982ad69bfc99ab53ce05f70d183bde5fb8c1837b83d791126aba61fde5e557b9c5f5a63b76c4be629c88fb6da12c536a0b3eb14e224bef99324047117edb7e2f5c55a04deefb32a85efa89db9c4ca473e92a30c7cb20cdcfe51b6923e5e6ed94c148afb201a5c1f2f6b061144ea1f4c47d9bf6cffaa6ac6f057dcec4d7453e2e6fe05c4c5dc63f67753d62c6acd61578de8d372169f9e5c4ace023e918ee4964cb41f7db23c796e34d706b6ca04e3f0157c2d39968ff4a99e3e795555e0a8df4ace4e7140e7c01d6c9ade61b6865816ffcdedf488e0edd9a01ff91087df6005261a5cb477dd8ebdb02a944203e148b085259b75f2f85241887337b92abeec9404712b5a6268c0c15d27d926d02dcc346fa05854d4eab89b15f280656ea76b0f051692518bf738238355d44d65199ebec39ec7dc1a49782f2843ca608972fcc83f69e8e14ae9ae34bb96c094a2c2f816059ac534b9c53ed7a462301a8b8aae6382f064d6d1b313e38ba2253ccd63c23c2a549fbbf7788bec44c7991cd3886435a78cff2e910ba1793f46c628ff63f8ce6698094af5cf07ea87b5a7c5dd06ef2b5ffa7b9c62e904fbd6f30749ba2e6b27e8b6005aa125ef18327e1ea3e19923ddf910649dbb98d68e876c1f2efd3e14e5228ff74594eb41407689638e01492b5016096eb3a36cddd58028e7e9ea1498a43a5d073bb84bae6b2b281fd3436e46a9e76f044cf66bbefc49cf65631cd6f3ef93b4bc77b46bd084b65d5f6e6b5963290306989b4f624052106b98d28217d806e2ffe247c7a61e043e86210d54453ea76edace4f933b814a5b6c6299027e1751af6683cc3bee62789be67eeefcb85bbc4dd7b1e9f7e1e61716225a2ae7e38c5e3578c7023c53fa81ec2cab211175fef5b4a2ea2e81c0fc002f069c0e7c2362443556b57c263ae9a060ea3e897c866e359218bbb9159bbe8071064fa75fb1720d0d0512bbba45b761c3dd285097da3dc4ff644497ab5b940fe4e39d674bb9b970fc4c25a9f82572e6b27a7afdce875d4be9e39805f8ac122c5c3a05a4a779a4113aed33c98b642313bdf333ea394b0e97751f6fec838a363d1aa8444fecdbba74360e0411cf45acc6ed697b1a4d1899bcd8bad91cf3d8064ece0c9f7ea00d62393ad6e27353a1e2b2616131ec05c3ad23bc1045b69f01e42248d8c02b3a0badffd141b4054b04a78e4c2cbdc1160cea45ee468bb5ca1b179882b919ed9b571ccd3e69230cbe9c42c4b9ec5bf893a7a23c5cc1b8fb2ee9435be26a7eb01a25607c764c03f5cbc9e5b74bf38b6e9dee3bea0ad76028bafea098d529525519a2627338ce2dd231e02720b49cfe5c05e2fe147e98a26e8015661f87efc26870c4b64acd049597e10e6fefe06f47211f6570791afac23f981ac0b8c74fded5cdbbd3c7ab7c7a92aea9e70f2ff78297cd930410720b09f980e873942776ff93ad148db97edfa3adb0bf36084f1dcea51587dc57d189cb65d58c79f276231bd617b03360787d839dc84b36e453644b8cb4d9d6292c042bac2a992f7ade9ddab55050e761cef6999a0fb25f763195db3fe20b24ca58a57e6d6e6b04ce27b5d9fd6bc739f0152f9dab33fe619cc6c8abd7c309e6188bfe9959f06d60e6ad475544bdae43a18403fa6601d3dede2d73986da4cf46e1cc3e8ea6fcaae5c2f6c3e38b42bc93c91c6b6ec32fa0599a6aea752c0be9b8e6f525ff2da39059e3dc4c808f7df7dec29bb0c063b66d1e02dd5dd8c378129fb262fe707da4a60a583bb967e4776840eba3d09829e0f5d55d220731ce7dc737021fd9dc08f7026555846a66ba31239f14b5767239f66906f78b7768c73ada776b62a7704bc9872fe64b416e5a177b251bd8c2520764da72e40ca7bed6939e99ee7b91c568d15387c6f894400e6a5f5bc30412564277ed352ae16200ae9134bf1b335be5862ae204e508f1317522dbfea8b59f7b2ee5288e87e8934b35653e0a4a13c98a6938c46608ec2aaeeefc593c9cef0940765f3d106f38aa21c891edb5242bdbd4b00cba09868f63c6a3182554bc74c2049d745d822aca0de3cfec0a2ce4f9dbf0611ba8823f21ad734fda09ec2b24b15b7ec75614ce8113c3f9470b22af670d3bc758a6a2831297c5ec72d46305a018750272faa5502659754675a15da38c27ad4a99584ed98d3cba9d08789e495b3aa5c33331a3f5fe4125b1f853b62701a881b8664ce7ce10a767dc7d15c5d15916fe0457761d7c4437981a0971dfbf70fc87ca66f178ccca2f830f5d6b16befeebf4f277b373b12ef03121c562d34c7ee24323a88979ea1f6f9fc070c14252d494c4f5f64697072abb3b9c3def5071213363b4966737d85889093b0b1bfc7ccd7ebf52e3b3e4961666d72767e838b92becfdde6edf100000000000000000000000a1d3245"
        );
        bytes memory m = hex"48656c6c6f"; // Hello

        bool _result = tracker.verify(sig, pk, m);
        console2.log("result", _result);
    }
}
